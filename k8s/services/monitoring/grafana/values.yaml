extraInitContainers:
  - name: init-db
    image: ghcr.io/cschmatzler/postgresql-initdb:15.2
    imagePullPolicy: Always
    envFrom:
      - secretRef:
          name: grafana-config
sidecar:
  dashboards:
    enabled: true
    searchNamespace: ALL
  datasources:
    enabled: true
    searchNamespace: ALL

persistence:
  enabled: false
testFramework:
  enabled: false

env:
  GF_ANALYTICS_CHECK_FOR_UPDATES: false
envFromSecrets:
  - name: grafana-config

dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: default
        orgId: 1
        folder: ""
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/default
datasources:
  datasources.yaml:
    apiVersion: 1
    deleteDatasources:
      - name: Loki
        orgId: 1
      - name: Alertmanager
        orgId: 1
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        url: http://thanos-query-frontend.monitoring.svc.cluster.local:9090
        isDefault: true
      - name: Loki
        type: loki
        access: proxy
        url: http://loki-gateway.monitoring.svc.cluster.local
        jsonData:
          maxLines: 250
      - name: Alertmanager
        type: alertmanager
        access: proxy
        url: http://kube-prometheus-stack-alertmanager.monitoring.svc.cluster.local:9093
        jsonData:
          implementation: prometheus
dashboards:
  default:
    cilium-operator:
      gnetId: 16612
      revision: 1
      datasource: Prometheus
    cilium-agent:
      gnetId: 16611
      revision: 1
      datasource: Prometheus
    cilium-hubble:
      gnetId: 16613
      revision: 1
      datasource: Prometheus
    external-secrets:
      url: https://raw.githubusercontent.com/external-secrets/external-secrets/main/docs/snippets/dashboard.json
      datasource: Prometheus
    flux-cluster:
      url: https://raw.githubusercontent.com/fluxcd/flux2/main/manifests/monitoring/monitoring-config/dashboards/cluster.json
      datasource: Prometheus
    flux-control-plane:
      url: https://raw.githubusercontent.com/fluxcd/flux2/main/manifests/monitoring/monitoring-config/dashboards/control-plane.json
      datasource: Prometheus
    flux-logs:
      url: https://raw.githubusercontent.com/fluxcd/flux2/main/manifests/monitoring/monitoring-config/dashboards/logs.json
      datasource:
        - name: DS_LOKI
          value: Loki

ingress:
  enabled: true
  ingressClassName: private
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt
    external-dns.alpha.kubernetes.io/target: liveview-template-app.manticore-hippocampus.ts.net
    ingress.kubernetes.io/force-ssl-redirect: "true"
  hosts:
    - &host grafana.liveview-template.app
  tls:
    - secretName: grafana-tls
      hosts:
        - *host

serviceMonitor:
  enabled: true

admin:
  existingSecret: grafana-config
  userKey: GRAFANA_USERNAME
  passwordKey: GRAFANA_PASSWORD

